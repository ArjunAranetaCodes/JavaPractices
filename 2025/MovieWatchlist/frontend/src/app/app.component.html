<div class="container">
  <div class="app-header">
    <h1>ðŸŽ¬ Movie Watchlist</h1>
    <p>Track your favorite movies</p>
  </div>

  <div class="stats-section">
    <div class="stat-item">
      <h3>Total Movies</h3>
      <div class="count">{{ movies.length }}</div>
    </div>
    <div class="stat-item">
      <h3>Watched</h3>
      <div class="count">{{ getWatchedCount() }}</div>
    </div>
    <div class="stat-item">
      <h3>Unwatched</h3>
      <div class="count">{{ getUnwatchedCount() }}</div>
    </div>
  </div>

  <div class="header-actions">
    <h2>My Movies</h2>
    <button class="btn btn-primary" (click)="openModal()">+ Add Movie</button>
  </div>

  <div class="filters-section">
    <input 
      type="text" 
      class="search-input" 
      placeholder="ðŸ” Search by title or director..."
      [(ngModel)]="searchTerm"
      (input)="onSearchChange()">
    
    <select 
      class="status-select" 
      [(ngModel)]="selectedStatus"
      (change)="onStatusChange()">
      <option value="">All Status</option>
      <option value="WATCHED">Watched</option>
      <option value="UNWATCHED">Unwatched</option>
    </select>

    <select 
      class="genre-select" 
      [(ngModel)]="selectedGenre"
      (change)="onGenreChange()">
      <option value="">All Genres</option>
      <option *ngFor="let genre of genres" [value]="genre">{{ genre }}</option>
    </select>

    <button 
      class="btn btn-secondary" 
      (click)="clearFilters()"
      *ngIf="searchTerm || selectedStatus || selectedGenre">
      Clear Filters
    </button>
  </div>

  <div class="movies-grid">
    <div 
      *ngFor="let movie of filteredMovies" 
      class="movie-card"
      [class.watched]="movie.status === 'WATCHED'">
      <div class="movie-header">
        <h3 class="movie-title">{{ movie.title }}</h3>
        <div class="movie-actions">
          <button class="btn btn-secondary btn-icon" (click)="openModal(movie)">Edit</button>
          <button class="btn btn-danger btn-icon" (click)="deleteMovie(movie.id!)">Delete</button>
        </div>
      </div>
      
      <div class="movie-info">
        <div class="info-row" *ngIf="movie.director">
          <strong>Director:</strong> {{ movie.director }}
        </div>
        <div class="info-row" *ngIf="movie.year">
          <strong>Year:</strong> {{ movie.year }}
        </div>
        <div class="info-row" *ngIf="movie.runtime">
          <strong>Runtime:</strong> {{ formatRuntime(movie.runtime) }}
        </div>
        <div class="info-row" *ngIf="movie.rating">
          <strong>Rating:</strong> 
          <span class="stars">{{ getRatingStars(movie.rating) }}</span>
        </div>
      </div>

      <div class="movie-footer">
        <div>
          <span *ngIf="movie.status" 
                class="status-badge"
                [class.status-watched]="movie.status === 'WATCHED'"
                [class.status-unwatched]="movie.status === 'UNWATCHED'">
            {{ movie.status }}
          </span>
          <span *ngIf="movie.genre" class="genre-badge" style="margin-left: 8px;">{{ movie.genre }}</span>
        </div>
        <button 
          class="btn btn-success btn-icon" 
          (click)="toggleMovieStatus(movie)">
          {{ movie.status === 'WATCHED' ? 'Mark Unwatched' : 'Mark Watched' }}
        </button>
      </div>
    </div>

    <div *ngIf="filteredMovies.length === 0" class="empty-state">
      <h3>No movies found</h3>
      <p *ngIf="searchTerm || selectedStatus || selectedGenre">Try adjusting your filters</p>
      <p *ngIf="!searchTerm && !selectedStatus && !selectedGenre">Add your first movie to get started!</p>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal" [class.show]="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ editingMovie ? 'Edit Movie' : 'Add New Movie' }}</h2>
      <span class="close" (click)="closeModal()">&times;</span>
    </div>
    <form (ngSubmit)="saveMovie()">
      <div class="form-group">
        <label for="title">Movie Title *</label>
        <input 
          type="text" 
          id="title" 
          [(ngModel)]="newMovie.title" 
          name="title"
          required
          placeholder="Enter movie title">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="director">Director</label>
          <input 
            type="text" 
            id="director" 
            [(ngModel)]="newMovie.director" 
            name="director"
            placeholder="Enter director name">
        </div>
        <div class="form-group">
          <label for="genre">Genre</label>
          <select 
            id="genre" 
            [(ngModel)]="newMovie.genre" 
            name="genre">
            <option value="">Select Genre</option>
            <option *ngFor="let genre of genres" [value]="genre">{{ genre }}</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="year">Release Year</label>
          <input 
            type="number" 
            id="year" 
            [(ngModel)]="newMovie.year" 
            name="year"
            min="1900"
            max="2100"
            placeholder="e.g., 2023">
        </div>
        <div class="form-group">
          <label for="runtime">Runtime (minutes)</label>
          <input 
            type="number" 
            id="runtime" 
            [(ngModel)]="newMovie.runtime" 
            name="runtime"
            min="1"
            placeholder="e.g., 120">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="rating">Rating (1-5)</label>
          <input 
            type="number" 
            id="rating" 
            [(ngModel)]="newMovie.rating" 
            name="rating"
            min="1"
            max="5"
            placeholder="1-5">
        </div>
        <div class="form-group">
          <label for="status">Status</label>
          <select 
            id="status" 
            [(ngModel)]="newMovie.status" 
            name="status">
            <option value="UNWATCHED">Unwatched</option>
            <option value="WATCHED">Watched</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="notes">Notes</label>
        <textarea 
          id="notes" 
          [(ngModel)]="newMovie.notes" 
          name="notes"
          placeholder="Add your thoughts about this movie..."></textarea>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-primary">Save</button>
      </div>
    </form>
  </div>
</div>

